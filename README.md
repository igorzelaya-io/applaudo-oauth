# Authentication and Authorization

## Environment:

-   Java version: 1.8

-   Maven version: 3.\*

-   Spring Boot version: 2.4.0

-   In Memory Repositories

## Notes:

-   The Application **must** accept request on port **`8000`**, by the
    default is running over the port `8080` and must be changed.

-   Token’s scopes are not been evaluated in this challenge, so the
    values are up to you.

-   The below resources are **read-only** and **must not been changed or
    push to the repository**:

    -   bin/\*

    -   security-challenge.postman\_collection.json

    -   java.postman\_environment.json

## Requirements

Your task is to secure the endpoints available in this API following the
[OAuth2](https://oauth.net/2/) Specification, using the Password and
Refresh Token grant types.

### Client Affiliation

Each client request support the following keys:

-   `name`: additional information that stores the name or alias of the
    client

-   `scopes`: space separated values

-   `redirectUri`: URI used for authentication redirects

-   `accessTokenExpiresInSeconds`: integer value that represents time in
    seconds before the access token could expire

-   `refreshTokenExpiresInSeconds`: integer value that represents time
    in seconds before the refresh token could expire

`POST` request to `/clients`

-   Should affiliate a new client into the Authorization Server

-   Client should support `password` and `refresh_token` grant types

-   Must return the bellow autogenerated values:

``` json
{
  "clientId": "f27dd283-32d6-462f-8554-03c344a02986",
  "clientSecret": "36bc23e2-ae1c-437b-be6d-6c0f4238a75c"
}
```

-   Curl Request\*

<!-- -->

    curl --request POST \
        --url http://localhost:8080/clients \
        --header 'Content-Type: application/json' \
        --data '{
            "name": "my-application",
            "scopes": "mp6WF46YZNaMFzfQ",
            "redirectUri": "mp6WF46YZNaMFzfQ",
            "accessTokenExpiresInSeconds": 60,
            "refreshTokenExpiresInSeconds": 60
        }'

**Response Body**

``` json
{
  "clientId": "f27dd283-32d6-462f-8554-03c344a02986",
  "clientSecret": "36bc23e2-ae1c-437b-be6d-6c0f4238a75c"
}
```

### User Signup

Each user signup request support the following keys:

-   `username`: the user nickname used for the authentication process

-   `password`: credentials for the authentication process

-   `roles`: array of string for each role to be assigned to the user

`POST` request to `/users`

-   Should signup a new user into the Authorization Server

-   Curl Request\*

``` bash
curl --request POST \
  --url http://localhost:8080/users \
  --header 'Content-Type: application/json' \
  --data '{
    "username": "applaudostudios",
    "password": "mp6WF46YZNaMFzfQ",
    "roles": ["USER", "ADMIN"]
}'
```

**Http Response**

    HTTP/1.1 201 OK

### Authentication

Each access token request must responses a JSON with the following keys:

-   `access_token`: the token that will be used for secured endpoints

-   `token_type`: OAuth2 token type

-   `refresh_token`: the token used to request a new access token
    without exchanging the User’s information

-   `expires_in`: time in seconds before the access token expires

-   `scope`: scopes that are available with the access token.

Here is an example of the response:

``` json
{
  "access_token": "0323ce87-efd0-4ca2-9150-386a327493c4",
  "token_type": "bearer",
  "refresh_token": "4880a778-287c-4e11-a134-21e971a36f9d",
  "expires_in": 43199,
  "scope": "any"
}
```

The task is to implement the Authentication Server that exposes
`/oauth/token` endpoint, which allow the generation of access tokens.

`POST` request to `/oauth/token`

Using the `password` Grant Type:

-   Creates an access token using Client and User Credentials.

-   Expects the Client and User Credentials.

-   If the given client and secret don’t match with Client ID
    `applaudostudios` with secret `mp6WF46YZNaMFzfQ`, the response code
    is 401.

-   If the given user credentials are incorrect, the response code
    is 400.

-   If a parameter is missing (based on OAuth2 Spec), the response code
    is 400.

-   If the information given is valid, the response code is 200

-   Curl Request\*

``` bash
curl --request POST \
  --url http://localhost:8080/oauth/token \
  --header 'Authorization: Basic YXBwbGF1ZG9zdHVkaW9zOm1wNldGNDZZWk5hTUZ6ZlE=' \
  --header 'Content-Type: application/x-www-form-urlencoded' \
  --data grant_type=password \
  --data client_id=applaudostudios \
  --data username=user@domain.com \
  --data password=password
```

**Response Body**

``` json
{
  "access_token": "0323ce87-efd0-4ca2-9150-386a327493c4",
  "token_type": "bearer",
  "refresh_token": "4880a778-287c-4e11-a134-21e971a36f9d",
  "expires_in": 43199,
  "scope": "any"
}
```

`POST` request to `/oauth/token`

Using the `refresh_token` Grant Type:

-   Creates an access token using Client Credentials with response code
    200

-   Expects the Client Credentials and Refresh Token.

-   Creates access token only for the Client ID `applaudostudios` with
    secret `mp6WF46YZNaMFzfQ`.

-   If the given client and secret don’t match with Client ID
    `applaudostudios` with secret `mp6WF46YZNaMFzfQ`, the response code
    is 401.

-   If the given refresh token is incorrect or expired, the response
    code is 400.

-   If a parameter is missing (based on OAuth2 Spec), the response code
    is 400.

-   If the information given is valid, the response code is 200

-   Curl Request\*

``` bash
curl --request POST \
  --url http://localhost:8080/oauth/token \
  --header 'Authorization: Basic YXBwbGF1ZG9zdHVkaW9zOm1wNldGNDZZWk5hTUZ6ZlE=' \
  --header 'Content-Type: application/x-www-form-urlencoded' \
  --data grant_type=refresh_token \
  --data refresh_token=7c74a1f3-41a4-40f2-a33a-dcda459fb1eata password=password
```

**Response Body**

``` json
{
  "access_token": "0323ce87-efd0-4ca2-9150-386a327493c4",
  "token_type": "bearer",
  "refresh_token": "4880a778-287c-4e11-a134-21e971a36f9d",
  "expires_in": 43199,
  "scope": "any"
}
```

### Secured Endpoints

The `artists` resources have been implemented, and your task is to
secure them using the following rules:

`GET` request to `/artists`

-   Must be public, anyone can access this endpoint.

-   Curl Request\*

``` bash
curl --request GET \
  --url http://localhost:8080/artists
```

**Response Body**

``` json
[
  {"name": "Rubens"},
  {"name": "Rothko"},
  {"name": "Joan Miro"},
  {"name": "Rembrandt"},
  {"name": "Durer"},
  {"name": "Diego Rivera"},
  {"name": "Munch"},
  {"name": "Chagall"},
  {"name": "Munch"},
  {"name": "Klimt"}
]
```

`GET` request to `/artists/{name}`

-   Only authenticated users are able to get an artist information based
    on its name.

-   If an access token has not been provided, the response code is 401.

-   If an access token is not valid, or it is expired, the response code
    is 401.

-   Curl Request\*

``` bash
curl --request GET \
  --url http://localhost:8080/artists/Durer \
  --header 'Authorization: Bearer 0323ce87-efd0-4ca2-9150-386a327493c4'
```

**Response Body**

``` json
{
  "name": "Durer"
}
```

`POST` request to `/artists/{name}`

-   Only users with the role `ADMIN` are able to create new artists.

-   If an access token does not belong to an admin user, the response
    code is 403.

-   If an access token has not been provided, the response code is 401.

-   If an access token is not valid, or it is expired, the response code
    is 401.

-   Curl Request\*

``` bash
curl --request POST \
  --url http://localhost:8080/artists \
  --header 'Authorization: Bearer 00e3c4fd-ffea-4843-9ee9-d265370951c5' \
  --header 'Content-Type: application/x-www-form-urlencoded' \
  --data '{
    "name": "Klimt"
}'
```

**Response Body**

``` json
{"name": "Klimt"}
```

### Test Endpoints

A Postman Collection has been provided for you, this collection has the
following folder:

1.  `start-here`: Here are some request examples that you can run
    against your application. We suggest to start developing these
    endpoints first, since they are the ones required for every test in
    the collection.

2.  `tests`: Here you can find the request along with the test
    scenarios, the scenarios have been design based on the requirements,
    and will be used to grade your solution.

You can follow the steps to [**import a collection into
Postman**](https://learning.postman.com/docs/getting-started/importing-and-exporting-data/)

Here are some useful information on [**how to run a
collection**](https://learning.postman.com/docs/running-collections/intro-to-collection-runs/).
Keep in mind that you will need to select the environment for all the
test to run.

You will need to import the below files (***The files could be found at
the root level of the project***):

1.  `security-challenge.post_collection.json`: Postman Collection.

2.  `java.postman_environment.json`: Environment variables needed by the
    collection

### Run Commands

If you want to run or install the application, here are some useful
commands:

**Start the application**

``` bash
mvn clean spring-boot:run
```

**Install the application**

``` bash
mvn clean install
```
